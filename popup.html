<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <style>
    * {
      box-sizing: border-box;
    }
    body {
      width: 1200px;
      padding: 15px;
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      font-size: 13px;
      background: #1e1e2e;
      color: #cdd6f4;
    }
    .main-container {
      display: grid;
      grid-template-columns: 1fr 1fr 600px;
      gap: 16px;
      margin-top: 12px;
    }
    .column {
      display: flex;
      flex-direction: column;
    }
    h1 {
      font-size: 18px;
      margin: 0 0 12px 0;
      color: #f5c2e7;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    h1::before {
      content: "üìö";
    }
    .status-card {
      background: #313244;
      border-radius: 8px;
      padding: 12px;
      margin-bottom: 12px;
      width: 100%;
    }
    .status-label {
      font-size: 11px;
      color: #6c7086;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 4px;
    }
    .status-value {
      font-size: 14px;
      color: #a6e3a1;
      font-weight: 500;
    }
    .status-value.inactive {
      color: #f9e2af;
    }
    .workspace-list {
      margin-top: 8px;
    }
    .workspace-item {
      display: inline-block;
      background: #45475a;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
      margin: 2px 4px 2px 0;
      cursor: pointer;
      transition: background 0.15s;
    }
    .workspace-item:hover {
      background: #585b70;
    }
    .workspace-item.active {
      background: #89b4fa;
      color: #1e1e2e;
    }
    button.active {
      background: #89b4fa;
      color: #1e1e2e;
    }
    button.active:hover {
      background: #b4befe;
    }
    .button-group {
      display: flex;
      gap: 8px;
      margin-bottom: 12px;
    }
    button {
      flex: 1;
      padding: 10px 12px;
      border: none;
      border-radius: 6px;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      transition: background 0.15s, transform 0.1s;
    }
    button:hover {
      transform: translateY(-1px);
    }
    button:active {
      transform: translateY(0);
    }
    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }
    .btn-primary {
      background: #89b4fa;
      color: #1e1e2e;
    }
      .btn-primary:hover {
        background: #b4befe;
      }
    .btn-secondary {
      background: #45475a;
      color: #cdd6f4;
    }
    .btn-secondary:hover {
      background: #585b70;
    }
    .btn-warning {
      background: #f9e2af;
      color: #1e1e2e;
    }
    .btn-warning:hover {
      background: #f5c2e7;
    }
    .message {
      padding: 10px 12px;
      border-radius: 6px;
      font-size: 12px;
      margin-bottom: 12px;
      display: none;
    }
    .message.success {
      display: block;
      background: #a6e3a1;
      color: #1e1e2e;
    }
    .message.error {
      display: block;
      background: #f38ba8;
      color: #1e1e2e;
    }
    .info {
      font-size: 11px;
      color: #6c7086;
      line-height: 1.5;
      padding: 10px;
      background: #313244;
      border-radius: 6px;
      margin-bottom: 12px;
      width: 100%;
    }
    .info strong {
      color: #cdd6f4;
    }
    .debug {
      font-size: 10px;
      color: #6c7086;
      line-height: 1.4;
      padding: 10px;
      background: #181825;
      border-radius: 6px;
      margin-top: 12px;
      margin-bottom: 12px;
      font-family: 'Courier New', monospace;
      max-height: 200px;
      overflow-y: auto;
      width: 100%;
    }
    .debug-header {
      font-size: 11px;
      color: #f38ba8;
      font-weight: 600;
      margin-bottom: 6px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    .debug-item {
      margin: 2px 0;
    }
    .debug-key {
      color: #89b4fa;
      display: inline-block;
      min-width: 100px;
    }
    .debug-value {
      color: #a6e3a1;
    }
    .debug-value.true {
      color: #a6e3a1;
    }
    .debug-value.false {
      color: #f38ba8;
    }
    .debug-value.null {
      color: #6c7086;
      font-style: italic;
    }
    .info-row {
      margin: 6px 0;
    }
    .info-label {
      font-size: 11px;
      color: #6c7086;
      display: block;
      margin-bottom: 2px;
    }
    .info-value {
      font-size: 13px;
      color: #cdd6f4;
    }
    .info-value.none {
      color: #6c7086;
      font-style: italic;
    }
    .tag-list {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      margin-top: 4px;
    }
    .tag {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 4px;
      font-size: 11px;
      background: #45475a;
    }
    .tag.current {
      background: #89b4fa;
      color: #1e1e2e;
    }
    .folder-list {
      margin-top: 4px;
    }
    .folder-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 6px 8px;
      background: #45475a;
      border-radius: 4px;
      margin: 4px 0;
      font-size: 12px;
    }
    .folder-name {
      color: #cdd6f4;
    }
    .folder-count {
      font-size: 10px;
      color: #6c7086;
    }
    .folder-count .num {
      color: #a6e3a1;
      font-weight: 500;
    }
    .error-box {
      padding: 12px;
      border-radius: 6px;
      margin-bottom: 12px;
      background: #f38ba8;
      color: #1e1e2e;
      font-size: 12px;
      line-height: 1.5;
      display: none;
    }
    .error-box.show {
      display: block;
    }
    .error-box strong {
      display: block;
      margin-bottom: 4px;
      font-weight: 600;
    }
  </style>
</head>
<body>
  <h1>Bookspace</h1>
  
  <div id="message" class="message"></div>
  
  <div id="error-box" class="error-box">
    <strong>‚ö†Ô∏è Workspace Detection Error</strong>
    <span id="error-message">Cannot determine current workspace state. This may be due to: (1) No containers available, (2) Container name does not match any bookspace folder, or (3) Bookspace folder not found. Ensure containers are created and attached to workspace tabs, and that container names match bookspace folder names. Check browser console for details.</span>
  </div>
  
  <div class="info">
    <strong>How it works:</strong><br>
    Create folders inside bookspace matching your container names. Attach Firefox containers to workspace tabs with names matching your bookspace folders. The extension automatically detects workspaces from container names. You can also manually switch workspaces by clicking workspace names in the current workspace section.
  </div>
  
  <div class="main-container">
    <div class="column">
      <div class="status-card">
        <div class="status-label">Current Workspace</div>
        <div id="current-workspace" class="status-value inactive">bookspace-none</div>
        <div id="workspace-list" class="workspace-list"></div>
        <div class="button-group" style="margin-top: 12px;">
          <button id="bookspace-none-btn" class="btn-secondary">bookspace-none</button>
          <button id="bookspace-all-btn" class="btn-secondary">bookspace-all</button>
        </div>
      </div>
      
      <div class="status-card">
        <div class="status-label">Container Info</div>
        <div id="container-info">
          <div class="info-row">
            <span class="info-label">Current Tab Container:</span>
            <span id="current-container" class="info-value">Loading...</span>
          </div>
          <div class="info-row">
            <span class="info-label">Available Containers:</span>
            <div id="container-list" class="tag-list"></div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="column">
      <div class="status-card">
        <div class="status-label">Bookspace Folders</div>
        <div id="bookspace-folders">
          <div id="folder-list" class="folder-list">Loading...</div>
        </div>
      </div>
    </div>
    
    <div class="column">
      <div class="debug">
        <div class="debug-header">üîç Debug State</div>
        <div id="debug-content"></div>
      </div>
      
      <div class="debug">
        <div class="debug-header">üîß API Availability</div>
        <div id="api-debug-content"></div>
      </div>
    </div>
  </div>
  
  <script src="popup.js"></script>
</body>
</html>
